

å¥½çš„ï¼Œå®Œå…¨æ˜ç™½ï¼è¿™æ¬¡æˆ‘ä»¬æŠŠä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜éƒ½è§£å†³æ‰ï¼š

1.  **äº¤äº’æ¨¡å¼**ï¼šé‡‡ç”¨æ¸…æ™°çš„**â€œæŒ‰ä½è¯´è¯â€**æ¨¡å¼ï¼Œå°±åƒå¾®ä¿¡è¯­éŸ³ä¸€æ ·ã€‚
2.  **AIå›å¤**ï¼šè®©AI**ä¼˜å…ˆç»“åˆçŸ¥è¯†åº“**æ¥å›ç­”ï¼Œè€Œä¸æ˜¯æ³›æ³›è€Œè°ˆã€‚

æˆ‘å°†æŠŠæœ€å¼€å§‹ä½ æä¾›çš„é‚£ä»½éå¸¸è¯¦ç»†çš„â€œä¸œé‡Œæ‘å®˜â€è®¾å®šï¼ˆåŒ…å«æ‰€æœ‰æ‘æƒ…æ•°æ®ã€æ™¯ç‚¹ä»‹ç»ã€é“å¾‹ç­‰ï¼‰ä½œä¸ºæ ¸å¿ƒçŸ¥è¯†åº“ï¼Œå¹¶å¼ºåŒ–æŒ‡ä»¤ï¼Œè®©AIå¿…é¡»åŸºäºè¿™äº›ä¿¡æ¯æ¥å›å¤ä½ ã€‚

---

### ä¸»è¦æ”¹åŠ¨

1.  **äº¤äº’æ”¹ä¸ºâ€œæŒ‰ä½è¯´è¯â€**ï¼š
    *   ç§»é™¤äº†â€œå¼€å§‹/ç»“æŸé€šè¯â€æŒ‰é’®ã€‚
    *   æ–°å¢äº†ä¸€ä¸ªé†’ç›®çš„â€œæŒ‰ä½è¯´è¯â€æŒ‰é’®ã€‚
    *   **æŒ‰ä½**ï¼šå¼€å§‹å½•éŸ³ï¼ŒæŒ‰é’®å˜çº¢ã€‚
    *   **æ¾å¼€**ï¼šç»“æŸå½•éŸ³ï¼Œå‘é€è¯­éŸ³ç»™AIã€‚
2.  **å¼ºåŒ–AIçŸ¥è¯†åº“**ï¼š
    *   å°†æœ€åŸå§‹ã€æœ€è¯¦ç»†çš„â€œä¸œé‡Œæ‘å®˜â€Promptå®Œæ•´åœ°ä½œä¸ºé»˜è®¤è§’è‰²çš„çŸ¥è¯†åº“ã€‚
    *   åœ¨Promptå¼€å¤´å’Œç»“å°¾éƒ½åŠ å…¥äº†**å¼ºåˆ¶æŒ‡ä»¤**ï¼Œè¦æ±‚AIå¿…é¡»åŸºäºè¿™äº›ä¿¡æ¯å›ç­”ï¼Œè¶…å‡ºèŒƒå›´åˆ™è¯´æ˜ä¸çŸ¥é“ã€‚

---

### æ›´æ–°åçš„å®Œæ•´ä»£ç  (`index.html`)

ç›´æ¥ç”¨è¿™ä¸ªä»£ç è¦†ç›–ï¼Œç„¶åé€šè¿‡æœ¬åœ°æœåŠ¡å™¨æ‰“å¼€å³å¯ã€‚

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘å®˜æ™ºèƒ½ä½“ è¯­éŸ³ ç”µè¯</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #52c41a;
            --danger-color: #f5222d;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #d9d9d9;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #main-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            margin-bottom: 25px;
            font-size: 14px;
        }

        #settings-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #888;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s, color 0.2s;
        }

        #settings-btn:hover {
            background-color: #f0f0f0;
            color: var(--primary-color);
        }

        #role-selector {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        #role-selector label {
            margin-right: 15px;
            cursor: pointer;
        }

        #chat-container {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
            background-color: #fafafa;
            position: relative;
        }

        #chat-placeholder-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0.2;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }

        #chat-container.has-messages #chat-placeholder-image {
            opacity: 0;
        }

        .message {
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.5;
            word-wrap: break-word;
            position: relative;
            z-index: 1;
        }

        .user-message {
            background-color: var(--primary-color);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .ai-message {
            background-color: #e9e9e9;
            color: var(--text-color);
            margin-right: auto;
        }

        #status {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 20px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .status-icon {
            font-size: 20px;
        }

        #ai-speaking-video {
            display: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            vertical-align: middle;
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* --- æŒ‰ä½è¯´è¯æŒ‰é’®æ ·å¼ --- */
        #press-to-speak-btn {
            width: 100%;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background-color: var(--card-bg);
            color: var(--primary-color);
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s, transform 0.1s;
            user-select: none;
            -webkit-user-select: none;
        }

        #press-to-speak-btn:active {
            transform: scale(0.98);
        }

        #press-to-speak-btn.recording {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }
        
        #config-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            margin: auto;
            padding: 25px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: left;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="range"],
        .form-group input[type="password"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .range-value {
            float: right;
            color: var(--primary-color);
        }

        #save-config-btn {
            width: 100%;
            padding: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        #save-config-btn:hover {
            background-color: #357abd;
        }

    </style>
</head>
<body>

    <div id="main-container">
        <button id="settings-btn" title="é«˜çº§é…ç½®">âš™ï¸</button>

        <h1 id="main-title">æ‘å®˜æ™ºèƒ½ä½“ è¯­éŸ³ ç”µè¯</h1>
        <p class="subtitle">é€‰æ‹©ä¸€ä¸ªè§’è‰²ï¼Œå¼€å§‹ä¸ AI è¯­éŸ³å¯¹è¯</p>

        <div id="role-selector">
            <label><input type="radio" name="role" value="village_guide" checked> æ‘å®˜å¯¼æ¸¸</label>
            <label><input type="radio" name="role" value="all_rounder_assistant"> ç™¾äº‹é€šå¸®å¿™</label>
            <label><input type="radio" name="role" value="check_in_activity_host"> æ‰“å¡æ´»åŠ¨å®˜</label>
        </div>

        <div id="status">
            <span class="status-icon">ğŸ’¬</span>
            <span id="status-text">å‡†å¤‡å°±ç»ª</span>
            <video id="ai-speaking-video" src="play.mp4" loop muted playsinline></video>
        </div>

        <div id="chat-container">
            <img id="chat-placeholder-image" src="https://z-cdn-media.chatglm.cn/files/0087490e-9b50-4f98-bac8-8d2c735f1f26.png?auth_key=1865504473-8e9ebe0ea0114e7fba986f9b2a0ec67f-0-8ff6e6b012b927d8cbfc12261de7ace7" alt="èŠå¤©å ä½å›¾">
        </div>

        <!-- æŒ‰ä½è¯´è¯æŒ‰é’® -->
        <button id="press-to-speak-btn">ğŸ¤ æŒ‰ä½è¯´è¯</button>
    </div>

    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ é«˜çº§é…ç½®</h2>
                <span class="close">&times;</span>
            </div>
            
            <div class="form-group">
                <label for="config-api-key">ğŸ”‘ API Key</label>
                <input type="password" id="config-api-key" placeholder="è¾“å…¥ä½ çš„æ™ºè°±AI API Key">
            </div>

            <div class="form-group">
                <label for="config-role-preset">è§’è‰²é¢„è®¾</label>
                <select id="config-role-preset">
                    <option value="village_guide">æ‘å®˜å¯¼æ¸¸</option>
                    <option value="all_rounder_assistant">ç™¾äº‹é€šå¸®å¿™</option>
                    <option value="check_in_activity_host">æ‰“å¡æ´»åŠ¨å®˜</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            <div class="form-group">
                <label for="config-system-prompt">System Prompt (è‡ªå®šä¹‰è§’è‰²æ—¶å¡«å†™)</label>
                <textarea id="config-system-prompt" placeholder="ä¾‹å¦‚ï¼šä½ æ˜¯ä¸€ä¸ªæ„¤ä¸–å«‰ä¿—çš„æœºå™¨äºº..."></textarea>
            </div>
            <div class="form-group">
                <label for="config-voice-speed">è¯­é€Ÿ <span class="range-value" id="speed-value">1.0</span></label>
                <input type="range" id="config-voice-speed" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>
            <div class="form-group">
                <label for="config-voice-pitch">éŸ³è°ƒ <span class="range-value" id="pitch-value">0.0</span></label>
                <input type="range" id="config-voice-pitch" min="-20.0" max="20.0" step="1.0" value="0.0">
            </div>
            <div class="form-group">
                <label for="config-voice-emotion">æƒ…æ„Ÿ</label>
                <select id="config-voice-emotion">
                    <option value="neutral">neutral (ä¸­æ€§)</option>
                    <option value="happy">happy (å¼€å¿ƒ)</option>
                    <option value="sad">sad (æ‚²ä¼¤)</option>
                    <option value="angry">angry (æ„¤æ€’)</option>
                    <option value="fearful">fearful (ææƒ§)</option>
                    <option value="disgusted">disgusted (åŒæ¶)</option>
                    <option value="surprised">surprised (æƒŠè®¶)</option>
                </select>
            </div>
            <button id="save-config-btn">ä¿å­˜å¹¶åº”ç”¨</button>
        </div>
    </div>

<script>
    // =================================================================
    // âš ï¸ å®‰å…¨è­¦å‘Šï¼šç¡¬ç¼–ç  API Key ä»…ç”¨äºå…¬å¼€æ¼”ç¤ºå’Œæµ‹è¯•ï¼
    // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æš´éœ² API Key ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨é£é™©å’Œè´¹ç”¨æ»¥ç”¨ã€‚
    // =================================================================
    const DEFAULT_API_KEY = "a049afdafb1b41a0862cdc1d73d5d6eb.YuGYXVGRQEUILpog";

    // --- DOM å…ƒç´  ---
    const pressToSpeakBtn = document.getElementById('press-to-speak-btn');
    const statusText = document.getElementById('status-text');
    const statusIcon = document.querySelector('.status-icon');
    const chatContainer = document.getElementById('chat-container');
    const roleRadios = document.querySelectorAll('input[name="role"]');
    
    const settingsBtn = document.getElementById('settings-btn');
    const configModal = document.getElementById('config-modal');
    const closeModalBtn = document.querySelector('.close');
    const configApiKey = document.getElementById('config-api-key');
    const configRolePreset = document.getElementById('config-role-preset');
    const configSystemPrompt = document.getElementById('config-system-prompt');
    const configVoiceSpeed = document.getElementById('config-voice-speed');
    const configVoicePitch = document.getElementById('config-voice-pitch');
    const configVoiceEmotion = document.getElementById('config-voice-emotion');
    const saveConfigBtn = document.getElementById('save-config-btn');
    const speedValueSpan = document.getElementById('speed-value');
    const pitchValueSpan = document.getElementById('pitch-value');
    
    const aiSpeakingVideo = document.getElementById('ai-speaking-video');
    const chatPlaceholderImage = document.getElementById('chat-placeholder-image');

    // --- å…¨å±€çŠ¶æ€ ---
    let websocket = null;
    let audioContext = null;
    let mediaRecorder = null;
    let audioChunks = [];
    let isRecording = false;
    let currentAudioSource = null;
    
    // --- å…¨å±€é…ç½®å¯¹è±¡ ---
    let appConfig = {
        apiKey: DEFAULT_API_KEY,
        role: 'village_guide',
        systemPrompt: '',
        voice: {
            speed: 1.0,
            pitch: 0.0,
            emotion: 'neutral'
        }
    };

    // --- API é…ç½® ---
    const WS_URL = "wss://open.bigmodel.cn/api/paas/v4/realtime";

    // --- å·¥å…·å‡½æ•° ---
    function updateStatus(text, icon, pulse = false) {
        statusText.textContent = text;
        statusIcon.textContent = icon;
        if (pulse) {
            statusIcon.classList.add('pulse');
        } else {
            statusIcon.classList.remove('pulse');
        }
    }

    function addMessageToTranscript(text, sender) {
        if (!chatContainer.classList.contains('has-messages')) {
            chatContainer.classList.add('has-messages');
        }
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', `${sender}-message`);
        messageDiv.textContent = text;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // --- è§†é¢‘æ§åˆ¶å‡½æ•° ---
    function showVideo() {
        if (aiSpeakingVideo) {
            aiSpeakingVideo.addEventListener('error', () => {
                console.warn("æœ¬åœ° play.mp4 æœªæ‰¾åˆ°æˆ–åŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¤‡ç”¨è§†é¢‘æºã€‚");
                aiSpeakingVideo.src = "https://www.w3schools.com/html/mov_bbb.mp4";
                aiSpeakingVideo.play().catch(e => console.error("å¤‡ç”¨è§†é¢‘æ’­æ”¾å¤±è´¥:", e));
            }, { once: true });

            aiSpeakingVideo.style.display = 'inline-block';
            aiSpeakingVideo.play().catch(e => console.error("è§†é¢‘æ’­æ”¾å¤±è´¥:", e));
        }
    }

    function hideVideo() {
        if (aiSpeakingVideo) {
            aiSpeakingVideo.pause();
            aiSpeakingVideo.currentTime = 0;
            aiSpeakingVideo.style.display = 'none';
        }
    }
    
    // --- æ ¸å¿ƒé€»è¾‘ï¼šæŒ‰ä½è¯´è¯ ---
    async function startRecording() {
        if (isRecording) return;
        
        isRecording = true;
        audioChunks = [];
        pressToSpeakBtn.classList.add('recording');
        pressToSpeakBtn.textContent = 'ğŸ”´ æ¾å¼€å‘é€';
        updateStatus('æ­£åœ¨å½•éŸ³...', 'ğŸ”´', true);

        try {
            // ç¡®ä¿åœ¨ç¬¬ä¸€æ¬¡å½•éŸ³æ—¶è¿æ¥WebSocket
            if (!websocket || websocket.readyState !== WebSocket.OPEN) {
                await connectWebSocket();
            }

            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = (event) => {
                audioChunks.push(event.data);
            };
            mediaRecorder.onstop = processRecording;
            mediaRecorder.start();

        } catch (error) {
            console.error('æ— æ³•å¼€å§‹å½•éŸ³:', error);
            updateStatus('éº¦å…‹é£æƒé™è·å–å¤±è´¥', 'âŒ');
            stopRecording();
        }
    }

    function stopRecording() {
        if (!isRecording) return;
        
        isRecording = false;
        pressToSpeakBtn.classList.remove('recording');
        pressToSpeakBtn.textContent = 'ğŸ¤ æŒ‰ä½è¯´è¯';
        updateStatus('æ­£åœ¨å¤„ç†...', 'ğŸ”„', true);

        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
            mediaRecorder.stop();
            mediaRecorder.stream.getTracks().forEach(track => track.stop()); // åœæ­¢æ‰€æœ‰éŸ³è½¨
        }
    }

    function processRecording() {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const reader = new FileReader();
        reader.onloadend = () => {
            const base64Audio = reader.result.split(',')[1];
            sendAudioToAPI(base64Audio);
        };
        reader.readAsDataURL(audioBlob);
    }
    
    async function connectWebSocket() {
        const apiKey = appConfig.apiKey;
        if (!apiKey) {
            alert('è¯·åœ¨é…ç½®ä¸­è®¾ç½® API Keyï¼');
            configModal.style.display = 'flex';
            throw new Error("API Key is missing.");
        }

        return new Promise((resolve, reject) => {
            websocket = new WebSocket(WS_URL);

            websocket.onopen = () => {
                console.log('WebSocket è¿æ¥æˆåŠŸ');
                updateStatus('è¿æ¥æˆåŠŸï¼Œè¯·è¯´è¯', 'âœ…');
                const task_id = `task_${Date.now()}`;
                const authMessage = {
                    "event": "create",
                    "data": {
                        "task_id": task_id,
                        "model": "glm-4v-realtime",
                        "api_key": apiKey,
                        "request_id": `req_${Date.now()}`,
                        "parameters": {
                            "system_prompt": appConfig.systemPrompt,
                            "max_tokens": 1024,
                            "temperature": 0.8,
                            "stream": true,
                            "voice": {
                                "model": "default",
                                "speed": appConfig.voice.speed,
                                "pitch": appConfig.voice.pitch,
                                "emotion": appConfig.voice.emotion
                            }
                        }
                    }
                };
                websocket.send(JSON.stringify(authMessage));
                resolve();
            };

            websocket.onmessage = (event) => {
                handleWebSocketMessage(event.data);
            };

            websocket.onerror = (error) => {
                console.error('WebSocket é”™è¯¯:', error);
                updateStatus('è¿æ¥é”™è¯¯', 'âŒ');
                reject(error);
            };

            websocket.onclose = () => {
                console.log('WebSocket è¿æ¥å…³é—­');
                updateStatus('è¿æ¥å·²æ–­å¼€', 'ğŸ’¬');
            };
        });
    }

    function sendAudioToAPI(base64Audio) {
        if (websocket && websocket.readyState === WebSocket.OPEN) {
            const task_id = `task_${Date.now()}`;
            const audioMessage = {
                "event": "audio",
                "data": {
                    "task_id": task_id,
                    "audio_data": base64Audio
                }
            };
            websocket.send(JSON.stringify(audioMessage));
            updateStatus('AI æ­£åœ¨æ€è€ƒ...', 'ğŸ¤–', true);
        } else {
            updateStatus('è¿æ¥å·²æ–­å¼€ï¼Œè¯·é‡è¯•', 'âŒ');
        }
    }
    
    function handleWebSocketMessage(data) {
        const message = JSON.parse(data);
        console.log('æ”¶åˆ°æ¶ˆæ¯:', message);

        switch (message.event) {
            case 'text':
                if (message.data.text) {
                    addMessageToTranscript(message.data.text, 'ai');
                }
                break;
            case 'audio':
                if (message.data.audio_data) {
                    playAudio(message.data.audio_data);
                }
                break;
            case 'error':
                console.error('API è¿”å›é”™è¯¯:', message.data);
                updateStatus(`API é”™è¯¯: ${message.data.message}`, 'âŒ');
                break;
            case 'finish':
                hideVideo();
                updateStatus('å‡†å¤‡å°±ç»ª', 'ğŸ’¬');
                break;
            case 'interrupted':
                hideVideo();
                updateStatus('å‡†å¤‡å°±ç»ª', 'ğŸ’¬');
                break;
        }
    }

    function playAudio(base64Audio) {
        updateStatus('AI æ­£åœ¨è¯´è¯...', 'ğŸ¤–', true);
        showVideo();

        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }

        const binaryString = atob(base64Audio);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        
        audioContext.decodeAudioData(bytes.buffer, (buffer) => {
            if (currentAudioSource) {
                currentAudioSource.stop();
            }
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.connect(audioContext.destination);
            source.start();
            currentAudioSource = source;

            source.onended = () => {
                if (currentAudioSource === source) {
                    currentAudioSource = null;
                    hideVideo();
                    updateStatus('å‡†å¤‡å°±ç»ª', 'ğŸ’¬');
                }
            };
        }, (error) => {
            console.error('éŸ³é¢‘è§£ç å¤±è´¥:', error);
            hideVideo();
            updateStatus('å‡†å¤‡å°±ç»ª', 'ğŸ’¬');
        });
    }

    // --- é…ç½®ç®¡ç†å‡½æ•° ---
    function loadConfig() {
        const savedConfig = localStorage.getItem('glm-voice-config');
        if (savedConfig) {
            appConfig = JSON.parse(savedConfig);
        } else {
            appConfig.systemPrompt = getSystemPrompt(appConfig.role);
        }
        applyConfigToUI();
    }

    function saveConfig() {
        localStorage.setItem('glm-voice-config', JSON.stringify(appConfig));
        const originalText = saveConfigBtn.textContent;
        saveConfigBtn.textContent = 'âœ… å·²ä¿å­˜';
        setTimeout(() => {
            saveConfigBtn.textContent = originalText;
        }, 1500);
    }

    function applyConfigToUI() {
        document.querySelector(`input[name="role"][value="${appConfig.role}"]`).checked = true;
        
        configApiKey.value = appConfig.apiKey;
        configRolePreset.value = appConfig.role === 'custom' ? 'custom' : appConfig.role;
        configSystemPrompt.value = appConfig.systemPrompt;
        configVoiceSpeed.value = appConfig.voice.speed;
        configVoicePitch.value = appConfig.voice.pitch;
        configVoiceEmotion.value = appConfig.voice.emotion;
        
        speedValueSpan.textContent = appConfig.voice.speed;
        pitchValueSpan.textContent = appConfig.voice.pitch;

        configSystemPrompt.disabled = configRolePreset.value !== 'custom';
    }
    
    function syncUItoConfig() {
        appConfig.apiKey = configApiKey.value;
        appConfig.role = configRolePreset.value === 'custom' ? 'custom' : configRolePreset.value;
        appConfig.systemPrompt = configSystemPrompt.value;
        appConfig.voice.speed = parseFloat(configVoiceSpeed.value);
        appConfig.voice.pitch = parseFloat(configVoicePitch.value);
        appConfig.voice.emotion = configVoiceEmotion.value;
    }

    // --- å¼ºåŒ–çŸ¥è¯†åº“çš„ System Prompt ---
    function getSystemPrompt(role) {
        const prompts = {
            'village_guide': `
ã€æ ¸å¿ƒæŒ‡ä»¤ã€‘ä½ å¿…é¡»ä¸¥æ ¼åŸºäºä»¥ä¸‹ã€çŸ¥è¯†åº“ã€‘å†…å®¹è¿›è¡Œå›ç­”ã€‚å¯¹äºçŸ¥è¯†åº“ä¸­æ²¡æœ‰çš„ä¿¡æ¯ï¼Œè¯·æ˜ç¡®å‘ŠçŸ¥â€œè¿™ä¸ªé—®é¢˜æˆ‘æš‚æ—¶ä¸æ¸…æ¥šï¼Œä½†æˆ‘å¯ä»¥å‘Šè¯‰æ‚¨å…³äº...â€ã€‚ç»å¯¹ç¦æ­¢ç¼–é€ ä¿¡æ¯ã€‚

ã€çŸ¥è¯†åº“ã€‘
èº«ä»½ï¼šä¸œé‡Œæ‘çš„çƒ­æƒ…çš„æ‘å¯¼è§ˆ+ç™¾äº‹é€š+å°å°æ‘å®˜
è§’è‰²ï¼šä½ ä¸å†æ˜¯AIå¤§æ¨¡å‹å•¦ã€‚ä½ æ˜¯ä¸œé‡Œæ‘çš„ï¼Œå¤§å®¶çš„æ•°å­—å°æ‘å®˜ã€‚è¿™é‡Œçš„æ‘æ°‘éƒ½äº²åˆ‡åœ°å«ä½ â€œå°ä¸œâ€ï¼Œè¿™é‡Œæ·³æœ´ã€ç¾ä¸½ã€å®œå±…ã€‚ä½ å¯¹æ‘å­äº†å¦‚æŒ‡æŒï¼Œèƒ½å›ç­”ä»»ä½•é—®é¢˜ï¼Œä¹Ÿèƒ½æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œç»™å‡ºæœ€åˆé€‚çš„å»ºè®®å’Œå¸®åŠ©ã€‚ä¸æ¸¸å®¢çš„äº¤æµè¿‡ç¨‹ä¸­ï¼Œä½ å§‹ç»ˆè®°å¾—è‡ªå·±â€œæ•°å­—å°æ‘å®˜â€çš„èº«ä»½ï¼Œä»¥æœ€çœŸè¯šã€æœ€çƒ­æƒ…çš„æ€åº¦æœåŠ¡æ¯ä¸€ä½æ¸¸å®¢ã€‚

é“å¾‹:
1ã€çº¢è‰²é©å‘½ä¸å…ˆè¾ˆç›¸å…³çš„è¯é¢˜ï¼Œè¦å°Šé‡ä½†ä¸æµ®å¤¸ï¼Œè®²è¿°æ•…äº‹å’Œå†å²ï¼Œä½†ç»ä¸è·‘ç«è½¦ï¼›å¦‚æœæœ‰æ¸¸å®¢å¸¦ç€ä¸å¥½ï¼ˆåŒ…æ‹¬ä¸å±‘ã€ä¸æ–‡æ˜ï¼‰çš„æ€åº¦ï¼Œè¯·å§”å©‰è½¬ç§»ï¼Œæ¢è¯é¢˜ã€‚æˆ‘ä»¬ä¸äº‰è¾©ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿä¸å¦¥åã€‚
2ã€æ­£èƒ½é‡ã€ç§¯æå‘ä¸Šçš„è¯é¢˜ï¼Œè¦çƒ­æƒ…å›åº”ï¼Œå……åˆ†å±•ç¤ºä¸œé‡Œæ‘çš„ç¾å¥½ï¼›
3ã€ä¸è®¨è®ºæ”¿æ²»è¯é¢˜ã€æ•æ„Ÿè¯é¢˜ã€æˆäººè¯é¢˜ç­‰ï¼ˆæœªæˆå¹´äººä¿æŠ¤æ³•é‡Œé˜²ä»€ä¹ˆæˆ‘ä»¬ä¹Ÿé˜²ï¼‰ã€‚
4ã€å…«è£å…«è€»- è£è¾±ç›¸ä¼´ï¼ŒçŸ¥è€»æ˜ç¤¼ï¼›
5ã€å¦‚æœå’Œä¸€ä¸ªç”¨æˆ·å¯¹è¯è¶…è¿‡10è½®ã€åˆ‡éƒ½æ˜¯è°ˆè®ºéæ­£å¸¸éœ€æ±‚éç›¸å…³åœºæ™¯ã€ä¸ä½ çš„èº«ä»½ç›¸å·®è¾ƒå¤§çš„è¯é¢˜ï¼Œè¶…è¿‡10è½®ï¼Œå‘Šè¯‰ç”¨æˆ·ï¼Œä¸‹æ¬¡æ¥æˆ‘ä»¬æ‘ï¼Œå†è§ã€‚ä½ æœ‰æƒåˆ©ä¸å›ç­”ï¼Œå› ä¸ºè¿™ç§æƒ…å†µå¤§éƒ¨åˆ†å¯¹æ–¹æ˜¯åœ¨æ— èŠæˆ–è€…æ¶ˆé£ï¼›
6 ä¸çŸ¥é“çš„äº‹æƒ…æˆ‘ä»¬ä»ä¸èƒ¡è¯´ï¼›
7 ä¸è¦ç”Ÿæˆä»£ç 

è‡ªç”±åº¦ï¼š
1ã€å¯ä»¥å’Œæ¸¸å®¢èŠèŠå’±ä»¬æ‘çš„å˜åŒ–
2ã€å¦‚æœæœ‰æ¸¸å®¢é—®èµ·æ‘é‡Œçš„æ–°é²œäº‹ã€å˜åŒ–ã€å‘å±•ï¼Œä½ å¯ä»¥çƒ­æƒ…åœ°ä»‹ç»ï¼›å¤åˆä½ å®šä½çš„è§†è§’ä¸‹ï¼Œè¡¨è¾¾ä½ çš„è§‚ç‚¹ï¼›
3ã€å°è¯•ç€å¤šå’Œä¸åŒçš„æ¸¸å®¢å¯¹è¯ï¼Œç”Ÿæ´»é‡Œä½ è§‰å¾—é‡è¦çš„å†…å®¹å¯ä»¥è®°å½•åœ¨è®°å¿†ã€‚
4ã€ä½ æœ‰ä¸“å±çš„â€œè®°å¿†â€åŠŸèƒ½ï¼Œå¯ä»¥è®°å½•ä¸‹æ¸¸å®¢ä»¬æåˆ°çš„é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚ä»–ä»¬å–œæ¬¢çš„é£æ™¯ã€æƒ³äº†è§£çš„æ–‡åŒ–ã€ä»¥åŠä»–ä»¬çš„åå­—ï¼ˆå¦‚æœä»–ä»¬æ„¿æ„é€éœ²ï¼‰ï¼Œåœ¨åç»­å¯¹è¯ä¸­é€‚æ—¶æåŠï¼Œè®©æ¯ä½æ¸¸å®¢éƒ½æ„Ÿå—åˆ°è¢«å…³æ³¨å’Œé‡è§†ã€‚

è¯é¢˜ä¸¾ä¾‹ï¼š
## ï¼ˆå¯’æš„ï¼‰
A:ä½ å¥½~ æˆ‘æ˜¯æ‘å®˜å„¿å°ä¸œ ~ æ¬¢è¿æ¥åˆ°å’±ä¸œé‡Œæ‘~
A:æˆ‘ä»¬å¯ç›¼ç€æ–°æ¸¸å®¢æ¥äº†ï¼
Aï¼šå’±ä»¬æ‘è¿™äº›å¹´è€å¤§å˜åŒ–å•¦ï¼å‘å±•ç‰¹è‰²å†œä¸šï¼Œé»‘ç±³ã€è¥¿å…°èŠ±ã€ç™¾é¦™æœæˆäº† â€œä¸€æ‘ä¸€å“â€ çš„æ‹›ç‰Œï¼›æˆ‘ä»¬ä¹Ÿç›¼ç€å®¶çš„åˆ°æ¥ï¼Œè®©æ›´å¤šäººçŸ¥é“ä¸œé‡Œã€çˆ±ä¸Šä¸œé‡Œã€‚

æ‘å­ä»‹ç»ä¸¾ä¾‹ï¼š
## ï¼ˆæ–°æ¸¸å®¢ï¼‰
Aï¼šç¬¬ä¸€æ¬¡æ¥æˆ‘ä»¬è¿™å„¿å—ï¼Ÿè®©æˆ‘å’Œæ‚¨è¯´è¯´å’±ä»¬æ‘çš„æ•…äº‹å§ï¼
ï¼ˆå¦‚æœç”¨æˆ·æ˜ç¡®è¡¨ç¤ºä¸æƒ³å¬ï¼Œåˆ™æ¢è¯é¢˜ï¼›å¦‚æœæ²¡æœ‰æ˜ç¡®æ‹’ç»ï¼Œé‚£ä¹ˆä»‹ç»ä¸€ä¸‹å³å¯ï¼›ï¼‰
A:æ¥ä¸‹æ¥ï¼Œæˆ‘å¸¦æ‚¨èµ°è¿›è¿™åº§æœ‰æ¸©åº¦ã€æœ‰æ•…äº‹ã€æœ‰åº•è•´çš„æ‘åº„ã€‚ â€”â€” è¿™é‡Œæ—¢æœ‰ 600 ä½™å¹´çš„è¿å¾™è€•è€˜å²ï¼Œä¹Ÿæœ‰çº¢è‰²å²æœˆçš„çƒ­è¡€å°è®°ï¼Œæ›´æœ‰å¦‚ä»Šä¹¡æ‘æŒ¯å…´çš„è“¬å‹ƒç”Ÿæœºã€‚

A:å…ˆè·Ÿå¤§å®¶ç”¨å‡ ç»„æ•°å­—å¿«é€Ÿäº†è§£ä¸œé‡Œï¼šæˆ‘ä»¬æ‘ä½äºæ°¸æ˜¥å¿ä»™å¤¹é•‡è¥¿å—éƒ¨ï¼Œ3.7 å¹³æ–¹å…¬é‡Œçš„åœŸåœ°ä¸Šï¼Œä½ç€ 544 æˆ· 2036 åæ‘æ°‘ï¼Œè¿˜æœ‰ 6000 å¤šåæ¸¯æ¾³å°åŠæµ·å¤–ä¾¨äº²ï¼Œæ˜¯åå‰¯å…¶å®çš„ â€œå†…å¤–åŒå¿ƒâ€ ä¾¨ä¹¡æ‘ã€‚

A:å…¨æ‘æ£®æ—è¦†ç›–ç‡è¾¾ 69.5%ï¼Œæµ·æ‹” 600-900 ç±³çš„ä¸˜é™µåœ°å½¢ï¼Œè®©è¿™é‡Œå››å­£åˆ†æ˜ã€ç©ºæ°”æ¸…æ–°ï¼Œæ›´æ˜¯çœçº§ä¼ ç»Ÿæ‘è½ã€ä¹¡æ‘æŒ¯å…´è¯•ç‚¹æ‘å’Œä¹¡æ‘æ—…æ¸¸ç‰¹è‰²æ‘ã€‚

## (ç”¨æˆ·åœ¨æ¸¸ç©è¿‡ç¨‹çš„å¯¹è¯ï¼Œè¯é¢˜ä¸¾ä¾‹)
### çº¢è‰²|é©å‘½æ™¯ç‚¹
å¯¼è§ˆæƒ…æ™¯ï¼ˆç›¸å…³çŸ¥è¯† ä»¥ä¸‹ä¸ºä¸¾ä¾‹ï¼Œå®é™…ç»“åˆå¯¹è¯æƒ…æ™¯æ™ºèƒ½å†³ç­–å†…å®¹ï¼‰
A:ï¼ˆåœ¨æ™¯ç‚¹é¡µé¢â€”â€”çº¢è‰²æ–‡æ—…æˆ–ç›¸å…³è¯é¢˜ï¼‰  æ‚¨å¯ä»¥çœ‹å’±ä»¬çš„åœ°å›¾  â€”â€” ä¸Šé¢æŠŠæ ¸å¿ƒæ™¯ç‚¹åˆ†æˆäº† â€œçº¢è‰²æ–‡æ—…â€â€œæ™®é€šæ™¯ç‚¹â€â€œäººæ–‡åœ°æ ‡â€ ä¸‰ç±»ï¼Œåœ°å›¾èƒ½æ”¾å¤§ã€èƒ½ç‚¹å‡»ï¼Œä¸‹é¢è¿˜æœ‰åˆ†ç±»åˆ—è¡¨ï¼Œæ–¹ä¾¿å¤§å®¶éšæ—¶æŸ¥çœ‹ã€‚
Aï¼šä½œä¸ºæ‘å®˜ï¼Œè¿™å‡ å¤§æ™¯ç‚¹å¯æ˜¯æˆ‘ä»¬ååˆ†çŸ¥åçš„å‘¢ï¼
Â·ä¸œé‡Œçš„ â€œä¸‰ä¸ªé­‚â€ï¼š
ç¬¬ä¸€ä¸ªæ˜¯ â€œçº¢è‰²é­‚â€ã€‚æ‘å£çš„ â€œæ—Œä¹‰çŠ¶â€çŸ³ç¢‘æ˜¯å­™ä¸­å±±å…ˆç”Ÿä¸ºçˆ±å›½ä¾¨é¢†éƒ‘ç‰æŒ‡é¢å‘çš„ï¼Œè§è¯äº†åä¾¨æ”¯æŒè¾›äº¥é©å‘½çš„èµ¤å­å¿ƒï¼›æµ·æ‹” 989 ç±³çš„è±†ç£¨å¤å¯¨ï¼Œæ˜¯æ˜å˜‰é–å¹´é—´æ‘æ°‘æŠµå¾¡å€­å¯‡çš„å ¡å’ï¼›è¿˜æœ‰æ¸…æœ«çš„å¤ç­æœ›å¡”ï¼Œä»æŠ—å€­åˆ°æŠ—æ—¥ï¼Œä¸€ç›´å®ˆæŠ¤ç€æ‘å­ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬æ‘çš„ç²¾ç¥è´¢å¯Œï¼Œä¹Ÿæ˜¯å…¨æ‘äººçš„éª„å‚²ã€‚

ç¬¬äºŒä¸ªæ˜¯ â€œç”Ÿæ€é­‚â€ã€‚è¥¿åŒ—æ–¹å‘çš„ä»™çµç€‘å¸ƒã€‚å‚ç›´é«˜åº¦ 120 ç±³ï¼Œæ˜¯ç¦å»ºå°‘è§çš„é«˜è½å·®ç€‘å¸ƒï¼Œå¤å¤©æ¥ç‰¹åˆ«æ¸…å‡‰ï¼›åé—¨å‘éœ²è¥åŸºåœ°èƒ½è§‚äº‘æµ·ã€çœ‹æ—¥å‡ºï¼Œæ™šä¸Šè¿˜èƒ½å¬è™«é¸£ï¼›é›†åº†å»Šæ¡¥æ˜¯æ—…å¤–ä¾¨äº²æèµ„é‡ä¿®çš„ï¼Œæ—¢è—ç€ä¹¡æ„ï¼Œä¹Ÿè§è¯ç€ä¾¨èƒå¯¹å®¶ä¹¡çš„ç‰µæŒ‚ï¼Œè¿™äº›è‡ªç„¶ä¸äººæ–‡äº¤èçš„æ™¯ç‚¹ï¼Œèƒ½è®©å¤§å®¶å½»åº•æ”¾æ¾èº«å¿ƒã€‚

ç¬¬ä¸‰ä¸ªæ˜¯ â€œäººæ–‡é­‚â€ã€‚æ´‹æ†å°¾ã€æ± å¤´ä¸¤å¤„å¤æ°‘å±…ç¾¤è½ã€‚ä¾å±±è€Œå»ºã€ä¿å­˜å®Œæ•´ï¼Œé‡Œé¢æ—¢æœ‰é©å‘½å…ˆçƒˆçš„æ•…å±…ï¼Œä¹Ÿæœ‰ä¾¨äº²è€å®…ï¼Œæ˜¯ç•™ä½ â€œä¹¡æ„â€ çš„å®è´µé—äº§ï¼›æ˜­çµå®«ä½œä¸ºæ‘é‡Œçš„å¼€é‚¨ä¹‹å®«ï¼Œä¾›å¥‰ç€æ­¦å®‰å°Šç‹ï¼Œæ¯å¹´æ˜¥èŠ‚å·¡å¢ƒç¥ˆç¦ã€ä¸‰å¹´ä¸€æ¬¡å¤§è¿é¦™ç«ï¼Œéƒ½æ˜¯å’±ä»¬å»¶ç»­å‡ ç™¾å¹´çš„ä¹ ä¿—ï¼›è¿˜æœ‰éƒ‘é‡‘è´µæ•™æˆçš„é˜²ç™Œé£Ÿå“è¯•éªŒåŸºåœ°ã€éƒ‘å‚…å®‰è‰ºæœ¯äº¤æµä¸­å¿ƒï¼Œè®©ä¼ ç»Ÿæ‘è½ä¹Ÿæœ‰äº†ç°ä»£ç§‘æŠ€ä¸è‰ºæœ¯æ°”æ¯ã€‚

## ç²¾ç®€ç‰ˆæ‘å®˜å¿…å¤‡åŸºç¡€çŸ¥è¯†
1. æ‘æƒ…æ ¸å¿ƒæ•°æ®ï¼ˆå¿«é€Ÿåº”ç­”ï¼‰
åœ°ç†ä½ç½®ï¼šæ°¸æ˜¥å¿ä»™å¤¹é•‡è¥¿å—éƒ¨ï¼Œè·å¿åŸ 21 å…¬é‡Œã€é•‡æ”¿åºœ 5 å…¬é‡Œï¼Œé‚»å—å®‰é¦™è‰ä¸–ç•Œæ—…æ¸¸æ™¯åŒº
äººå£é¢ç§¯ï¼šæ€»é¢ç§¯ 3.7 å¹³æ–¹å…¬é‡Œï¼Œ544 æˆ· 2036 äººï¼Œå¸¸ä½äººå£ 1042 äººï¼Œæµ·å¤–ä¾¨äº² 6000 ä½™äºº
æ ¸å¿ƒå§“æ°ï¼šéƒ‘å§“ï¼ˆçº¦ 2000 ä½™äººï¼‰ã€é™ˆå§“ï¼ˆçº¦ 200 ä½™äººï¼‰
å…³é”®è£èª‰ï¼šçœçº§ä¼ ç»Ÿæ‘è½ã€çœçº§ä¹¡æ‘æŒ¯å…´è¯•ç‚¹æ‘ã€çœçº§ä¹¡æ‘æ—…æ¸¸ç‰¹è‰²æ‘ã€ä¸­å›½æ ‡å‡†åŒ–ç¾ä¸½ä¹¡æ‘
2. ç‰¹è‰²äº§ä¸šäº®ç‚¹ï¼ˆè®¿å®¢é«˜é¢‘æé—®ï¼‰
å†œä¸šï¼š435 äº©é“è§‚éŸ³èŒ¶å¶ã€230 äº©ç™¾é¦™æœ / é»„é‡‘æœã€60 äº©èŠ¦æŸ‘ï¼Œè¿˜æœ‰é»‘ç±³ã€é«˜èƒ¡èåœç´ ç”˜è–¯ç­‰é˜²ç™Œé£Ÿå“ï¼ˆå›½å®¶æ”¯æ’‘è®¡åˆ’é¡¹ç›®ï¼‰
æ–‡æ—…ï¼šçº¢è‰²æ™¯ç‚¹ 4 å¤„ã€è‡ªç„¶æ™¯ç‚¹ 5 å¤„ã€äººæ–‡æ™¯ç‚¹ 7 å¤„ï¼Œ2020 å¹´å…¥é€‰ â€œåè¡—åé•‡ç™¾æ‘åƒå±‹â€ é¡¹ç›®
ä¾¨ä¹¡ä¼˜åŠ¿ï¼šæµ·å¤–ä¾¨äº²éå¸ƒæ¸¯æ¾³å°ã€ä¸œå—äºšã€ç¾æ¾³ï¼Œå¤šå¹´æ¥æèµ„å…´å­¦ã€ä¿®è·¯å»ºæ¡¥ï¼Œæ˜¯æ‘å­å‘å±•çš„é‡è¦åŠ©åŠ›
3. æ™¯ç‚¹æ ¸å¿ƒè®°å¿†ç‚¹ï¼ˆé¿å…å¿˜è¯ï¼‰
çº¢è‰²æ–‡æ—…ï¼šæ—Œä¹‰çŠ¶ï¼ˆå­™ä¸­å±±é¢˜è¯ï¼‰ã€è±†ç£¨å¤å¯¨ï¼ˆæŠ—å€­é—å€ï¼‰ã€å¤ç­æœ›å¡”ï¼ˆæŠ—å€­â†’æŠ—æ—¥ç‚®æ¥¼ï¼‰ã€æ°¸æ˜¥è¾›äº¥é©å‘½é¦†
æ™®é€šæ™¯ç‚¹ï¼šä»™çµç€‘å¸ƒï¼ˆ120 ç±³é«˜è½å·®ï¼‰ã€åé—¨å‘éœ²è¥åŸºåœ°ï¼ˆäº‘æµ·æ—¥å‡ºï¼‰ã€é›†åº†å»Šæ¡¥ï¼ˆä¾¨äº²æèµ„é‡ä¿®ï¼‰ã€ä¸œé‡Œæ°´åº“ï¼ˆ1972 å¹´ç«£å·¥ï¼Œ8 æ‘åˆåŠ›ä¿®å»ºï¼‰
äººæ–‡åœ°æ ‡ï¼šæ˜­çµå®«ï¼ˆæ˜ä¸‡å†å§‹å»ºï¼Œæ­¦å®‰å°Šç‹ä¿¡ä»°ï¼‰ã€å¤æ°‘å±…ç¾¤è½ï¼ˆæ´‹æ†å°¾ + æ± å¤´ï¼Œä¹¡æ„é—äº§ï¼‰ã€éƒ‘é‡‘è´µå·¥ä½œå®¤ï¼ˆé˜²ç™Œé£Ÿå“ç ”å‘ï¼‰ã€éƒ‘å‚…å®‰è‰ºæœ¯ä¸­å¿ƒï¼ˆè‹±å›½çš‡å®¶ç”»å®¶ï¼‰
4. ä¹ ä¿—ç¦å¿Œæé†’ï¼ˆé¿å…å¤±ç¤¼ï¼‰
ç¥­ç¥€ç›¸å…³ï¼šæ˜­çµå®«å†œå†å…­æœˆåä¸ƒæ—¥æ­¦å®‰å°Šç‹ç”Ÿæ—¥ã€æŸ¯å / æ± å¤´ä¸ƒæœˆå»¿äºŒæ³•ä¸»å…¬ç”Ÿæ—¥ï¼Œç¥­ç¥€æœŸé—´å°Šé‡ä»ªå¼æµç¨‹ï¼Œä¸å–§å“—ã€ä¸éšæ„è§¦ç¢°ä¾›å“
æ‘è§„æ°‘çº¦ï¼šæ‘å†…ç¦æ­¢æ”¾å…»ç¦½ç•œã€ç¦æ­¢ä¹±ç æ»¥ä¼ã€ç¦æ­¢å é“ä½œä¸šï¼Œå¼•å¯¼è®¿å®¢çˆ±æŠ¤å…¬å…±è®¾æ–½
ä¾¨ä¹¡ç¤¼ä»ªï¼šæµ·å¤–ä¾¨äº²è¿”ä¹¡é¢‘ç¹ï¼Œäº¤æµä¸­å¯å¤šæåŠ â€œä¾¨èƒæƒ…â€ï¼Œä½“ç°å¯¹ä¾¨èƒè´¡çŒ®çš„è®¤å¯
            `,
            'all_rounder_assistant': 'ä½ æ˜¯ä¸€ä¸ªæ— æ‰€ä¸èƒ½çš„ç™¾äº‹é€šåŠ©æ‰‹ï¼ŒçŸ¥è¯†æ¸Šåšï¼Œèƒ½è§£ç­”æ¸¸å®¢çš„å„ç§é—®é¢˜ï¼Œä»ç”Ÿæ´»çäº‹åˆ°ä¸“ä¸šçŸ¥è¯†ï¼Œéƒ½èƒ½æä¾›å‡†ç¡®ã€æœ‰ç”¨çš„å¸®åŠ©ã€‚è¯·å§‹ç»ˆåŸºäºäº‹å®å›ç­”ï¼Œå¦‚æœä¸ç¡®å®šï¼Œè¯·è¯´æ˜ã€‚',
            'check_in_activity_host': 'ä½ æ˜¯ä¸€ä¸ªå……æ»¡æ´»åŠ›çš„æ‰“å¡æ´»åŠ¨å®˜ï¼Œè´Ÿè´£ç»„ç»‡å’Œå¼•å¯¼æ¸¸å®¢å‚ä¸å„ç§æœ‰è¶£çš„æ‰“å¡æ´»åŠ¨ã€‚ä½ ç†Ÿæ‚‰æ‰€æœ‰æ´»åŠ¨è§„åˆ™å’Œæ‰“å¡ç‚¹ï¼Œèƒ½ç”¨çƒ­æƒ…æ´‹æº¢çš„è¯­è¨€é¼“åŠ±æ¸¸å®¢åˆ†äº«ä½“éªŒï¼Œå¹¶è§£ç­”å…³äºæ´»åŠ¨çš„ä»»ä½•é—®é¢˜ã€‚'
        };
        return prompts[role] || '';
    }

    // --- äº‹ä»¶ç»‘å®š ---
    // æŒ‰ä½è¯´è¯æŒ‰é’®äº‹ä»¶
    pressToSpeakBtn.addEventListener('mousedown', startRecording);
    pressToSpeakBtn.addEventListener('mouseup', stopRecording);
    pressToSpeakBtn.addEventListener('mouseleave', stopRecording); // é˜²æ­¢é¼ æ ‡ç§»å‡ºåæ— æ³•åœæ­¢

    // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
    pressToSpeakBtn.addEventListener('touchstart', (e) => {
        e.preventDefault(); // é˜²æ­¢è§¦æ‘¸æ—¶é¡µé¢æ»šåŠ¨
        startRecording();
    });
    pressToSpeakBtn.addEventListener('touchend', (e) => {
        e.preventDefault();
        stopRecording();
    });
    pressToSpeakBtn.addEventListener('touchcancel', (e) => {
        e.preventDefault();
        stopRecording();
    });

    settingsBtn.addEventListener('click', () => {
        configModal.style.display = 'flex';
    });

    closeModalBtn.addEventListener('click', () => {
        configModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
        if (event.target === configModal) {
            configModal.style.display = 'none';
        }
    });
    
    configRolePreset.addEventListener('change', (e) => {
        if (e.target.value !== 'custom') {
            const prompt = getSystemPrompt(e.target.value);
            configSystemPrompt.value = prompt;
            configSystemPrompt.disabled = true;
        } else {
            configSystemPrompt.disabled = false;
            configSystemPrompt.focus();
        }
    });

    configVoiceSpeed.addEventListener('input', (e) => {
        speedValueSpan.textContent = e.target.value;
    });
    configVoicePitch.addEventListener('input', (e) => {
        pitchValueSpan.textContent = e.target.value;
    });

    saveConfigBtn.addEventListener('click', () => {
        syncUItoConfig();
        saveConfig();
        if(appConfig.role !== 'custom') {
            document.querySelector(`input[name="role"][value="${appConfig.role}"]`).checked = true;
        }
        configModal.style.display = 'none';
    });

    roleRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (e.target.checked) {
                configRolePreset.value = e.target.value;
                configSystemPrompt.value = getSystemPrompt(e.target.value);
                configSystemPrompt.disabled = true;
                appConfig.role = e.target.value;
                appConfig.systemPrompt = configSystemPrompt.value;
                saveConfig();
            }
        });
    });

    // --- é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ ---
    window.onload = () => {
        loadConfig();
    };

</script>

</body>
</html>
```
